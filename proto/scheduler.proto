syntax = "proto3";

import "trigger.proto";
import "invocation.proto";

package scheduler_proto;

service Scheduler {
  /// Install or update a trigger onto the scheduler
  rpc InstallTrigger (InstallTriggerRequest)  returns (InstallTriggerResponse);
  /// Manually run a trigger
  rpc InvokeTrigger (InvokeTriggerRequest)  returns (InvokeTriggerResponse);
  /// Get a trigger by id
  rpc GetTrigger (GetTriggerRequest)  returns (GetTriggerResponse);
  /// Find a list of triggers by condition
  rpc FindTriggers (FindTriggersRequest)  returns (FindTriggersResponse);
  /// Retrieve a list of triggers 
  rpc ListTriggers (ListTriggersRequest)  returns (ListTriggersResponse);
  /// Pause a running trigger
  rpc PauseTrigger (PauseTriggerRequest)  returns (PauseTriggerResponse);
  /// Resume a paused/active trigger
  rpc ResumeTrigger (ResumeTriggerRequest)  returns (ResumeTriggerResponse);
  /// Cancel trigger
  rpc CancelTrigger (CancelTriggerRequest)  returns (CancelTriggerResponse);
}

message InstallTriggerRequest {
  string owner_id = 1;
  uint64 cell_id = 2;
  /// [Future] User supplied identifier, unique per owner account
  optional string reference_id = 3;
  optional string name = 4;
  optional string description = 5;
  repeated trigger_proto.Emit emit = 7;
  trigger_proto.Payload payload = 8;
  trigger_proto.Schedule schedule = 9;
  //trigger_proto.EventRetryPolicy event_retry_policy = 10;
  //OnStatusHandler on_success = 12;
  //OnStatusHandler on_failure = 13;
}

// == INSTALL OR UPDATE EXISTING TRIGGER ==
message InstallTriggerResponse {
  trigger_proto.Trigger trigger = 1;
}

// PAUSE TRIGGER
message PauseTriggerRequest {
  string id = 1;
  string owner_id = 2;
}

message PauseTriggerResponse {
  trigger_proto.TriggerManifest trigger = 1;
}

// RESUME TRIGGER
message ResumeTriggerRequest {
  string id = 1;
  string owner_id = 2;
}

message ResumeTriggerResponse {
  trigger_proto.TriggerManifest trigger = 1;
}

// CANCEL TRIGGER
message CancelTriggerRequest {
  string id = 1;
  string owner_id = 2;
}

message CancelTriggerResponse {
  trigger_proto.TriggerManifest trigger = 1;
}


// == EXECUTE TRIGGER MANUALLY ==
message InvokeTriggerRequest {
  string id = 1;
  string owner_id = 2;
}

message InvokeTriggerResponse {
  invocation_proto.Invocation invocation = 1;
}

// == GET TRIGGER ==
message GetTriggerRequest {
  string id = 1;
  string owner_id = 2;
}

message GetTriggerResponse {
  trigger_proto.Trigger trigger = 1;
}

// == Find TRIGGERS ==
message FindTriggersRequest {
}
message FindTriggersResponse {
}

// == LIST TRIGGER ==
message ListTriggersRequest {
  string owner_id = 1;
  uint64 limit = 2;
  optional string before = 3;
  optional string after = 4;
}

message ListTriggersResponse {
  repeated trigger_proto.TriggerManifest triggers = 1;
}
